FROM node:jod-alpine

WORKDIR /usr/app

COPY package.json ./

RUN npm install

COPY . .

ARG JWT_SECRET
ARG DATABASE
ARG DATABASE_PASSWORD
ARG DATABASE_PORT

ENV JWT_SECRET=$JWT_SECRET
ENV DATABASE=$DATABASE
ENV DATABASE_PASSWORD=$DATABASE_PASSWORD
ENV DATABASE_PORT=$DATABASE_PORT

RUN npm i -g pnpm

RUN pnpm build

CMD ["node", "dist/main.js"]